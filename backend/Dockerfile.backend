FROM openjdk:17-jdk-slim

WORKDIR /opt/traccar

RUN apt-get update && apt-get install -y git

COPY ./traccar /opt/traccar
COPY ./traccar/setup/traccar.xml /opt/traccar/conf/traccar.xml

WORKDIR /opt/traccar

# Use Gradle to build the project
RUN ./gradlew assemble

ENTRYPOINT ["java", "-Xms1g", "-Xmx1g", "-Djava.net.preferIPv4Stack=true", "-jar", "target/tracker-server.jar", "conf/traccar.xml"]